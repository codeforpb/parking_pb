---
title: Parken in Paderborn
---
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Parken in Paderborn</title>
<!--    <link rel="stylesheet" href="style.css" type="text/css"> -->
    <style type="text/css">
        html, body {
            height: 100%;
        }
        #map {
            width: 100%;
            height: 80%;
            border: 1px solid black;
        }
        .olPopup p { margin:0px; font-size: .9em;}
        .olPopup h2 { font-size:1.2em; }
    </style>
<!--    <script src="OpenLayers.js"></script> -->
    <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="jquery-csv.js"></script> 
    <script src="OpenLayers.js"></script>
    <script type="text/javascript">
        var map, select, markers;
        var projection = new OpenLayers.Projection("EPSG:4326");

        var styleMap = new OpenLayers.StyleMap({'default':{
                    pointerEvents: "visiblePainted",
                    externalGraphic: "/img/parking_lot_marker_${bg}.png",
                    graphicWidth: 64,
                    graphicHeight: 18,
                    label : '${free}/${count}',
                    fontColor: '#000',
                    fontSize: "12px",
                    fontFamily: "Courier New, monospace",
                    fontWeight: "bold"
                }});

        function init(){
            var options = {
                projection: new OpenLayers.Projection("EPSG:900913"),
                displayProjection: new OpenLayers.Projection("EPSG:4326")
            };
            map = new OpenLayers.Map('map', options);
            var mapnik = new OpenLayers.Layer.OSM("OpenStreetMap (Mapnik)");
            map.addLayer(mapnik);
 
            var lonLat = transformCoordinates(8.75456929206848, 51.71960448493701);
            map.setCenter(lonLat, 15);

            loadParkingData(map,mapnik);
        }

        function transformCoordinates(lon, lat){
            var projectionObj =  map.getProjectionObject();
            return new OpenLayers.LonLat(lon, lat)
                                 .transform(projection, projectionObj);
        }

        function loadParkingData(map,mapnik){
            var xhr = new XMLHttpRequest();




            xhr.onreadystatechange = function()
            {
                if (xhr.readyState== 4 && xhr.status == 200){
                    showParkingData(xhr.responseText);
                }
            }
            xhr.open("GET", "newest.json", true);
            xhr.send(null);
        }

        function showParkingData(responseText){
            var renderer = OpenLayers.Util.getParameters(window.location.href).renderer;
            renderer = (renderer) ? [renderer] : OpenLayers.Layer.Vector.prototype.renderers;

            var vectorLayer = new OpenLayers.Layer.Vector("Parkplätze", {
                styleMap: styleMap,
                renderers: renderer
            });

            var array = JSON.parse(responseText);
            var size = new OpenLayers.Size(50,18);
            var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
 
            map.addControl(new OpenLayers.Control.LayerSwitcher());

            for (var i = 0; i < array.length; i++) {
                var parkingLot = array[i];
                addParkingLotToMap(vectorLayer, parkingLot);
            }

            map.addLayer(vectorLayer);
        }

       function addParkingLotToMap(vectorLayer, parkingLot){
             var free = parkingLot.free;
             var count = parkingLot.count;
             var projectionObj =  map.getProjectionObject();

             var point = new OpenLayers.Geometry.Point(parkingLot.lon, parkingLot.lat).transform(projection,projectionObj);
             var pointFeature = new OpenLayers.Feature.Vector(point);
             pointFeature.attributes = {
                name: parkingLot.name,
                free: parkingLot.free,
                count: parkingLot.count,
                bg: getColor(free, count)
            };
            vectorLayer.addFeatures([pointFeature]);
       }

        function getColor(free, count){
            if(free == '?'){
                return 'white'; 
            }

            var freeRatio = free/count;                 
            if (freeRatio < 0.25) {
                return 'red';
            }
            else if (freeRatio < 0.75) {
                return 'yellow';
            }
            else {
                return 'green';
            }
        }
     </script>
  </head>
  <body onload="init()">
    <h1 id="title">Parken in Paderborn</h1>
    <div id="map" class="map"></div>
    <div id="explanations"><p>"?" heißt, dass ein Parkplatz nicht im Parkleitsystem erfasst ist.</p></div>
    <div id="content"></div>
    <div id="libs"><a href="http://wiki.openstreetmap.org/wiki/OpenLayers">OpenLayers</a>, <a href="https://code.google.com/p/jquery-csv/">jquery-csv</a>, <a href="http://code.jquery.com/">jQuery</a></div>

  </body>
</html>

